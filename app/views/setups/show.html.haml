-title = "Details about this setup"
-meta title: title

-#- source = setup_url(@setup)
-#- caption = ""
-#- caption_twitter = ""
-#- description = ""
-#- thumb = ""
-#- keywords = %w{' '}
-#- meta title: title,
  -#keywords: keywords,
  -#description: description,
  -#og: { title: :title,
    -#description: description,
    -#image: thumb,
    -#url: request.url,
  -#}
-#- img_size =  browser.mobile? ? :index : :grande
-#-cache ['v1', admin?,  img_size, @setup] do

-cache ['v1', admin?,  @setup] do
  .entity-outer
    .entity
      .entity-inner
        %header
          %h1#page-title{tabindex: -1}
            =title
            %small
              Last Updated:
              %time= @setup.updated_at.strftime("%a, %d %b %Y")
            
            

        .row
          .col-md-6
            .panel.panel-default
              %h2.panel-heading Selected setup
              %table.table
                %caption.sr-only Attributes for #{@setup}
                %tbody
                  %tr
                    %th{scope: "row"} Platform 
                    %td= link_to @setup.platform_version, platform_version_path(@setup.platform_version)
                    %td<
                      .truncate=to_html @setup.platform_version.notes

                  %tr
                    %th{scope: "row"} Assistive technology 
                    %td= link_to @setup.assistive_technology_version, assistive_technology_version_path(@setup.assistive_technology_version)
                    %td<
                      .truncate= to_html @setup.assistive_technology_version.notes
                  %tr
                    %th{scope: "row"} Reader 
                    %td= link_to @setup.browser_reader_version, browser_reader_version_path(@setup.browser_reader_version)
                    %td<
                      .truncate= to_html @setup.browser_reader_version.notes
                  %tr
                    %th{scope: "row"} File format
                    %td= link_to @setup.file_format, file_format_path(@setup.file_format)
                    %td<
                      .truncate= to_html @setup.file_format.notes
                  %tr
                    %th{scope: "row"} Renderer
                    %td= link_to @setup.renderer, renderer_path(@setup.renderer)
                    %td<
                      .truncate= to_html @setup.renderer.notes
                  %tr
                    %th{scope: "row"} Workflow status
                    %td=labeled @setup.workflow_status
                    %td


            .panel.panel-default
              %h2.panel-heading Access Mode
              %table.table<
                %tbody<
                  - capabilities = @setup.capabilities
                  - outputs = []
                  -@outputs.each do |o|
                    %th{scope: 'col'}<
                      =link_to o, output_path(o)
                    - these_outputs = []
                    - affordances = @setup.affordances.sorted.where output_id: o.id
                    - affordances.each do |a|
                      - capability = capabilities.find{|c| a.id == c.affordance_id}
                      - these_outputs.push(capability)
                    - @setup.other_affordances.sorted.where(output_id: o.id).each do |a|
                      - these_outputs.push(a)
                    - outputs.push(these_outputs)
                  -count = Feature.all.count
                  -0.upto(count) do |c|
                    -if !outputs.collect{|o| o[c]}.compact.empty?
                      %tr<
                        -outputs.each do |e|
                          -if e[c].kind_of?(Capability)
                            = render "capabilities/capability", capability: e[c]
                          -elsif e[c].kind_of?(Affordance)
                            = render "affordances/affordance", affordance: e[c]
                          -else
                            %td.disabled

              -#-if admin? and @setup.capabilities.count < Affordance.all.count
                -#.panel-footer= link_to "Add another capability", new_capability_path(setup_id: @setup.id), class: 'btn btn-success'


          .col-md-6
            %h2 Notes
            = to_html(@setup.notes)

            -if @setup.content_sources.length > 0
              %h2 Content Sources
              %ul
                - @setup.content_sources.each do |c|
                  %li= link_to c, content_source_path(c)

        -if admin?
          %nav.show-nav{role:"navigation"}
            = link_to edit_setup_path(@setup), title: "Edit this Setup", class: 'btn btn-primary' do
              %i.fa.fa-fw.fa-pencil{title: 'Pencil'}
              Edit
            = link_to setups_path, class: 'btn btn-info', title: "View the setups index" do
              %i.fa.fa-fw.fa-list{title: 'List'}
              Setups
            = link_to new_setup_path, class: 'btn btn-success' do
              %i.fa.fa-fw.fa-plus{title: 'plus'}
              Add another Setup
            %br
            %br
            = link_to new_setup_path(id: @setup.id), class: 'btn btn-success' do
              %i.fa.fa-fw.fa-mail-forward{title: 'forward arrow'}
              Copy this setup

        -#%h3 Content Sources
        -#%ul
        -#- @setup.content_sources.each do |c|
          -#%li= link_to c, content_source_path(c)
